#Make
rr -b -q 'TreeAnalyzer/background_estimation/predMacros/makeBETrees.C+("/eos/uscms/store/user/lpchh/HHWWbb_trees/3_28_18_complete/TTJets_SingleLeptFromT_TuneCUETP8M1_13TeV-madgraphMLM-pythia8/crab_tbar-t1l-madgraph/180330_001301/0000/tbar-t1l-madgraph_1.root",1,"test.root")'
./running/runBatchJobs.py  -m TreeAnalyzer/background_estimation/predMacros/makeBETrees.C -b -w -i procdatasets.conf  -j jobs/4_30_beTreees -o out 

#PREP
./compile.sh jobs/4_30_beTreees/ compiled/
. /Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/predMacros/getAreaReady.sh /uscms/home/nmccoll/nobackup/2011-04-15-susyra2/rel_HbbWW/work/analyzer_running/compiled/ trees/ /Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/predMacros/skimTree.C
. /Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/predMacros/runInputs.sh . /Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/predMacros/
 
#TEST
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotSignalTests.C+   (0,true    ,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotSignalTests.C+   (1,true    ,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotSignalTests.C+   (2,true    ,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotSignalTests.C+   (3,true    ,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotSignalTests.C+   (4,true    ,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotSignalTests.C+   (3,false   ,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotSignalTests.C+   (4,false   ,"baseline")'

rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotNonResBkgTests.C+ (2,true,0,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotNonResBkgTests.C+ (3,true,0,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotNonResBkgTests.C+ (4,true,0,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotNonResBkgTests.C+ (5,true,0,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotNonResBkgTests.C+ (6,true,0,"baseline")'

rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotNonResBkgTests.C+(0,false,0,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotNonResBkgTests.C+(1,false,1,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotNonResBkgTests.C+(2,false,1,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotNonResBkgTests.C+(3,false,1,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotNonResBkgTests.C+(4,false,1,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotNonResBkgTests.C+(5,false,1,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotNonResBkgTests.C+(6,false,1,"baseline")'

rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotResBkgTests.C+    (0,true,0,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotResBkgTests.C+    (1,true,0,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotResBkgTests.C+    (2,true,0,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotResBkgTests.C+    (3,true,0,"baseline")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotResBkgTests.C+    (4,true,0,"baseline")'

rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotResBkgTests.C+   (0,false,2,"qgCR")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotResBkgTests.C+   (1,false,2,"qgCR")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotResBkgTests.C+   (2,false,2,"qgCR")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotResBkgTests.C+   (3,false,2,"qgCR")'
rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotResBkgTests.C+   (4,false,2,"qgCR")'

rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotResBkgTests.C+    (5,true,true,"ePTRatio0p4_wQCD_sepQGemu")'

rr '/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/plotting/plotCRBkgTests.C+    (0,true)'

#limits
. /Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/predMacros/makeCards.sh nonCond_ePTRatio0p4_wQCD_sepQGemu 0 0 /Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/background_estimation/predMacros/
nohup combine -m 2500 -M AsymptoticLimits -v 2 --run expected  combinedCard.txt &
nohup combine -m 1000 -M AsymptoticLimits -v 2 --run expected  combinedCard.txt &

treeMaker->cd()
Events->Draw("hbbCSVCat>>h1(7,-0.5,6.5)","xsec*trig_N*pu_N*lep_N*btag_N*((hwwPT/hhMass>(isMuon?0.3:0.4))&&wwDM<2&&nAK4Btags==0&&hbbNSJs==2&&wjjNSJs==2&&hhMass>700&&hbbMass>100&&hbbMass<150&&process==3)")
new TCanvas();
Events->Draw("hbbBBT>>h2(20,-1,1)","xsec*trig_N*pu_N*lep_N*btag_N*((hwwPT/hhMass>(isMuon?0.3:0.4))&&wwDM<2&&nAK4Btags==0&&hbbNSJs==2&&wjjNSJs==2&&hhMass>700&&hbbMass>100&&hbbMass<150&&process==3)")
h1->Scale(1./h1->Integral());
h2->Scale(1./h2->Integral());


text2workspace.py combinedCard.txt -o combined.root
~/GitRepositories/TreeAnalyzer/framework/HiggsAnalysis/CombinedLimit/exe/combine -M MaxLikelihoodFit -m 2000 combined.root  
 python ~/GitRepositories/TreeAnalyzer/framework/HiggsAnalysis/CombinedLimit/test/diffNuisances.py -g plots.root fitDiagnostics.root 
 
 python ~/GitRepositories/TreeAnalyzer/limit_plotting/runPostFitHH.py -i combined.root -s "radHH" -r 0

/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/framework/HiggsAnalysis/CombinedLimit/exe/combine -M GoodnessOfFit combinedCard.txt --algo saturated --fixedSignalStrength 0 --plots
/Users/nmccoll/Dropbox/Work/GitRepositories/TreeAnalyzer/framework/HiggsAnalysis/CombinedLimit/exe/combine -M GoodnessOfFit combinedCard.txt --algo saturated --fixedSignalStrength 0 --plots -t 100